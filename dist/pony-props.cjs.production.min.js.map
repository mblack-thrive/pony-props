{"version":3,"file":"pony-props.cjs.production.min.js","sources":["../src/use-pony/usePony.interface.ts","../src/use-pony/usePony.state.ts","../src/use-pony/utils/get-flex-order.ts","../src/use-pony/usePony.ts"],"sourcesContent":["export enum ActionKind {\n  Next = 'Next',\n  Previous = 'Previous',\n  Reset = 'Reset',\n}\n\nexport type State = {\n  activeSlideIndex: number;\n  slideDirection: ActionKind;\n};\n\nexport type Action = {\n  type: ActionKind;\n  payload: {\n    numItems: number;\n  };\n};\n","import { Action, ActionKind, State } from './usePony.interface';\n\nexport const initialState: State = {\n  activeSlideIndex: 0,\n  slideDirection: ActionKind.Reset,\n};\n\nexport const reducer = (prevState: State, action: Action) => {\n  const { type, payload } = action;\n\n  switch (type) {\n    case ActionKind.Reset:\n      return initialState;\n    case ActionKind.Previous:\n      const isFirstIndex = prevState.activeSlideIndex === 0;\n      return {\n        ...prevState,\n        slideDirection: ActionKind.Previous,\n        activeSlideIndex: isFirstIndex\n          ? payload?.numItems - 1\n          : prevState.activeSlideIndex - 1,\n      };\n    case ActionKind.Next:\n      const isLastIndex = prevState.activeSlideIndex === payload.numItems - 1;\n      return {\n        ...prevState,\n        slideDirection: ActionKind.Next,\n        activeSlideIndex: isLastIndex ? 0 : prevState.activeSlideIndex + 1,\n      };\n    default:\n      return prevState;\n  }\n};\n","/**\n * Gets the flex order for a slide.\n * @param index - the index of the slide\n * @param activeSlideIndex - the current/visible slide index\n * @param numItems - number of slides in carousel\n * @returns the flex order for a carousel item\n */\nexport const getOrder = ({\n  index,\n  activeSlideIndex,\n  numItems,\n}: Record<'index' | 'activeSlideIndex' | 'numItems', number>) =>\n  index - activeSlideIndex < 0\n    ? numItems - Math.abs(index - activeSlideIndex)\n    : index - activeSlideIndex;\n","import {\n  CSSProperties,\n  useReducer,\n  useState,\n  AriaAttributes,\n  useEffect,\n  useRef,\n} from 'react';\nimport { ActionKind } from './usePony.interface';\nimport { initialState, reducer } from './usePony.state';\nimport { getOrder } from './utils/get-flex-order';\n\n// TODO: readme\n\nexport const usePony = ({\n  numItems,\n  initialActiveSlideIndex = initialState.activeSlideIndex,\n  isAnnouncerVisible = false,\n  reduceMotion = false,\n  transitionDuration = 500,\n  onInit,\n  onAfterChange,\n}: {\n  numItems: number;\n  initialActiveSlideIndex?: number;\n  isAnnouncerVisible?: boolean;\n  reduceMotion?: boolean;\n  transitionDuration?: number;\n  onInit?(): void;\n  onAfterChange?(activeIndex: number): void;\n}) => {\n  const [state, dispatch] = useReducer(reducer, {\n    ...initialState,\n    activeSlideIndex: initialActiveSlideIndex,\n  });\n  const sectionRef = useRef<HTMLDivElement>(null);\n  const headingRef = useRef<HTMLHeadingElement>(null);\n  const carouselWrapperRef = useRef<HTMLDivElement>(null);\n  const carouselRef = useRef<HTMLUListElement>(null);\n  const carouselItemRef = useRef<HTMLLIElement>(null);\n  const buttonRef = useRef<HTMLButtonElement>(null);\n  const announcerRef = useRef<HTMLDivElement>(null);\n  const TRANSITION_DURATION_MS = reduceMotion ? 0 : transitionDuration;\n\n  const [currentSwipeDirection, setCurrentSwipeDirection] = useState<\n    ActionKind.Previous | ActionKind.Next | null\n  >(null);\n\n  useEffect(() => {\n    if (onInit) {\n      onInit();\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!sectionRef.current) {\n      throw new Error('please apply getSectionProps() to your <section>');\n    }\n    if (!headingRef.current) {\n      throw new Error('please apply getHeadingProps() to your <h{1,2,3}>');\n    }\n    if (!carouselWrapperRef.current) {\n      throw new Error('please apply getCarouselWrapperProps() to your <div>');\n    }\n    if (!carouselRef.current) {\n      throw new Error('please apply getCarouselProps() to your <ul>');\n    }\n    if (!carouselItemRef.current) {\n      throw new Error('please apply getCarouselItemProps() to your <li>');\n    }\n    if (!buttonRef.current) {\n      throw new Error('please apply getButtonProps() to your <button>');\n    }\n    if (!announcerRef.current) {\n      throw new Error('please apply getAnnouncerProps() to your <div>');\n    }\n  }, [\n    sectionRef,\n    headingRef,\n    carouselWrapperRef,\n    carouselRef,\n    carouselItemRef,\n    buttonRef,\n    announcerRef,\n  ]);\n\n  useEffect(() => {\n    // Listen for swipe direction changes. Apply appropriate translateX transition.\n    if (currentSwipeDirection) {\n      const transformArray = [\n        { transform: 'translateX(-100%)' },\n        { transform: 'translateX(0px)' },\n      ];\n\n      carouselRef?.current?.animate(\n        currentSwipeDirection === ActionKind.Previous\n          ? transformArray\n          : transformArray.reverse(),\n        {\n          easing: 'ease-in',\n          duration: TRANSITION_DURATION_MS,\n        }\n      );\n\n      // Automatically focus on new active carousel slide for a11y reasons.\n      setTimeout(() => {\n        onAfterChange && onAfterChange(state.activeSlideIndex);\n        document.getElementById('carousel-item-active')?.focus();\n      }, TRANSITION_DURATION_MS);\n    }\n  }, [state.activeSlideIndex, currentSwipeDirection, numItems]);\n\n  const slide = (slideDirection: ActionKind.Previous | ActionKind.Next) => {\n    setCurrentSwipeDirection(slideDirection);\n    dispatch({ type: slideDirection, payload: { numItems } });\n  };\n\n  const getSectionProps = () => ({\n    ref: sectionRef,\n    as: 'section',\n    'aria-labelledby': 'carousel-heading',\n    'aria-roledescription': 'carousel',\n  });\n\n  const getHeadingProps = () => ({\n    ref: headingRef,\n    id: 'carousel-heading',\n  });\n\n  const getCarouselWrapperProps = () => ({\n    ref: carouselWrapperRef,\n    style: { width: '100%', overflow: 'hidden' },\n  });\n\n  const getCarouselProps = () => ({\n    ref: carouselRef,\n    'aria-label': 'Slides',\n    style: {\n      display: 'flex',\n    },\n  });\n\n  const getCarouselItemProps = (index: number) => ({\n    ref: carouselItemRef,\n    id: `carousel-item-${index}${\n      index === state.activeSlideIndex ? '-active' : ''\n    }`,\n    'aria-roledescription': 'slide',\n    'aria-label': `${index + 1} of ${numItems}`,\n    'aria-current': index === state.activeSlideIndex,\n    // 'aria-hidden': index !== state.activeSlideIndex,\n    style: {\n      order: getOrder({\n        index,\n        activeSlideIndex: state.activeSlideIndex,\n        numItems,\n      }),\n      display: 'flex',\n      flex: '1 0 100%',\n      flexBasis: '100%',\n      transition:\n        // Only apply this transition when the current swipe direction is next\n        // This ensures the re-ordering of items is smoother.\n        currentSwipeDirection === ActionKind.Next\n          ? `order ${TRANSITION_DURATION_MS / 1000 + 0.1}s ease-in`\n          : 'none',\n    },\n  });\n\n  const getButtonProps = (\n    direction: ActionKind.Previous | ActionKind.Next\n  ) => ({\n    ref: buttonRef,\n    'aria-label': direction === ActionKind.Previous ? 'Previous' : 'Next',\n    onClick: () => slide(direction),\n  });\n\n  const getAnnouncerProps = () => ({\n    ref: announcerRef,\n    'aria-live': 'polite' as AriaAttributes['aria-live'],\n    'aria-atomic': 'true' as AriaAttributes['aria-atomic'],\n    style: isAnnouncerVisible\n      ? {}\n      : ({\n          clip: 'rect(0 0 0 0)',\n          clipPath: 'inset(50%)',\n          height: '1px',\n          overflow: 'hidden',\n          position: 'absolute',\n          whiteSpace: 'nowrap',\n          width: '1px',\n        } as CSSProperties),\n  });\n\n  return {\n    // prop getters.\n    getSectionProps,\n    getHeadingProps,\n    getCarouselWrapperProps,\n    getCarouselProps,\n    getCarouselItemProps,\n    getButtonProps,\n    getAnnouncerProps,\n    // state.\n    state: {\n      ...state,\n      currentSwipeDirection,\n    },\n  };\n};\n"],"names":["ActionKind","initialState","activeSlideIndex","slideDirection","Reset","reducer","prevState","action","payload","type","Previous","numItems","Next","getOrder","index","Math","abs","initialActiveSlideIndex","isAnnouncerVisible","reduceMotion","transitionDuration","onInit","onAfterChange","useReducer","state","dispatch","sectionRef","useRef","headingRef","carouselWrapperRef","carouselRef","carouselItemRef","buttonRef","announcerRef","TRANSITION_DURATION_MS","useState","currentSwipeDirection","setCurrentSwipeDirection","useEffect","current","Error","transformArray","transform","animate","reverse","easing","duration","setTimeout","document","getElementById","focus","getSectionProps","ref","as","getHeadingProps","id","getCarouselWrapperProps","style","width","overflow","getCarouselProps","display","getCarouselItemProps","order","flex","flexBasis","transition","getButtonProps","direction","onClick","getAnnouncerProps","clip","clipPath","height","position","whiteSpace"],"mappings":"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"}